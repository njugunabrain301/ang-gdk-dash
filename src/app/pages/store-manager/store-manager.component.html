<div class="h-full flex flex-col">
  <mat-card class="flex-1 flex flex-col overflow-hidden">
    <div class="p-4 border-b">
      <h2 class="text-2xl font-semibold text-gray-800 flex items-center">
        <mat-icon class="mr-2 text-blue-600">smart_toy</mat-icon>
        Store Manager AI Assistant
      </h2>
      <p class="text-sm text-gray-600 mt-1">
        Ask me anything about your store, products, orders, or statistics
      </p>
    </div>

    <!-- Chat Messages Container -->
    <div
      #chatContainer
      class="flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50"
      style="max-height: calc(100vh - 250px);"
    >
      <div
        *ngFor="let message of messages"
        class="flex"
        [ngClass]="{
          'justify-end': message.role === 'user',
          'justify-start': message.role === 'assistant'
        }"
      >
        <div
          class="max-w-3xl rounded-lg p-4 shadow-sm"
          [ngClass]="{
            'bg-blue-600 text-white': message.role === 'user',
            'bg-white text-gray-800 border border-gray-200': message.role === 'assistant'
          }"
        >
          <div class="flex items-start">
            <mat-icon
              *ngIf="message.role === 'assistant'"
              class="mr-2 mt-1 text-blue-600"
              style="font-size: 20px; width: 20px; height: 20px;"
            >
              smart_toy
            </mat-icon>
            <mat-icon
              *ngIf="message.role === 'user'"
              class="mr-2 mt-1 text-white"
              style="font-size: 20px; width: 20px; height: 20px;"
            >
              person
            </mat-icon>
            <div class="flex-1">
              <div
                class="text-sm font-medium mb-1"
                [ngClass]="{
                  'text-white': message.role === 'user',
                  'text-gray-700': message.role === 'assistant'
                }"
              >
                {{ message.role === 'user' ? 'You' : 'AI Assistant' }}
              </div>
              <div
                class="text-sm whitespace-pre-wrap"
                [ngClass]="{
                  'text-white': message.role === 'user',
                  'text-gray-800': message.role === 'assistant'
                }"
              >
                {{ message.content }}
              </div>
              <div
                class="text-xs mt-2 opacity-70"
                [ngClass]="{
                  'text-white': message.role === 'user',
                  'text-gray-500': message.role === 'assistant'
                }"
              >
                {{ message.timestamp | date: 'short' }}
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Loading Indicator -->
      <div *ngIf="isLoading" class="flex justify-start">
        <div
          class="max-w-3xl rounded-lg p-4 shadow-sm bg-white border border-gray-200"
        >
          <div class="flex items-center">
            <mat-icon class="mr-2 text-blue-600" style="font-size: 20px; width: 20px; height: 20px;">
              smart_toy
            </mat-icon>
            <div class="flex items-center">
              <mat-spinner diameter="20" class="mr-2"></mat-spinner>
              <span class="text-sm text-gray-600">Thinking...</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Input Area -->
    <div class="p-4 border-t bg-white">
      <div class="flex items-end space-x-2">
        <mat-form-field class="flex-1" appearance="outline">
          <mat-label>Type your question...</mat-label>
          <textarea
            matInput
            [(ngModel)]="currentQuery"
            (keydown)="onKeyPress($event)"
            placeholder="Ask me anything about your store..."
            rows="2"
            [disabled]="isLoading"
            class="resize-none"
          ></textarea>
        </mat-form-field>
        <button
          mat-raised-button
          color="primary"
          (click)="sendMessage()"
          [disabled]="!currentQuery.trim() || isLoading"
          class="mb-2"
        >
          <mat-icon>send</mat-icon>
          Send
        </button>
      </div>
      <div class="text-xs text-gray-500 mt-2">
        Press Enter to send, Shift+Enter for new line
      </div>
    </div>
  </mat-card>
</div>

